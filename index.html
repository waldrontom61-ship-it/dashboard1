<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YMCA Overlay Dashboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');

  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #000;
  }

  /* Media container */
  .media-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 70%;
    height: 100%;
    overflow: hidden;
    z-index: 0;
    background: #000;
  }

  .media-container img,
  .media-container iframe {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Sidebar */
  .overlay {
    position: fixed;
    top: 0;
    right: 0;
    width: 30%;
    height: 100%;
    z-index: 1;
    display: flex;
    align-items: stretch;
    pointer-events: none;
  }

  .sidebar {
    width: 100%;
    height: 100%;
    background-color: rgba(224, 0, 52, 0.9);
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    pointer-events: auto;
    font-family: 'Montserrat', sans-serif;
  }

  #sidebar-header { text-align: center; font-size: 24px; font-weight: 900; margin-bottom: 20px; }
  .weather-nowplaying { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 14px; }
  .weather p { margin: 0; display: flex; align-items: center; gap: 6px; }
  #weather-emoji { font-size: 1.4em; }
  .now-playing { background: rgba(255, 255, 255, 0.2); padding: 5px 10px; border-radius: 6px; font-weight: bold; white-space: nowrap; }
  .schedule { flex-grow: 1; }
  #schedule-header { text-align: center; font-size: 18px; font-weight: 900; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.4); }
  .schedule ul { list-style: none; padding: 0; margin: 0 0 20px 0; }
  .schedule li { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); text-align: center; }
  #quote-slider { text-align: center; font-size: 32px; font-style: italic; margin-bottom: 20px; min-height: 50px; line-height: 1.5; }
  #logo-container { text-align: center; margin-top: auto; margin-bottom: 20px; }
  #logo { width: 80%; max-width: 150px; }
</style>
</head>
<body>

<!-- Media container -->
<div class="media-container" id="media-container"></div>

<!-- Sidebar -->
<div class="overlay">
  <div class="sidebar">
    <h2 id="sidebar-header">YMCA of Saskatoon Schedule</h2>

    <div class="weather-nowplaying">
      <div class="weather">
        <p>
          <span id="weather-emoji">â›…</span>
          <span id="temperature">--</span> |
          <span id="condition">--</span> |
          <span id="wind">--</span>
        </p>
      </div>
      <div class="now-playing" id="now-playing">
        Now: <span id="now-playing-class">Checking...</span>
      </div>
    </div>

    <div class="schedule">
      <div id="schedule-header"></div>
      <ul id="schedule"></ul>
    </div>

    <div id="quote-slider"></div>

    <div id="logo-container">
      <img id="logo" src="https://ymcasaskatoon.org/wp-content/uploads/2022/06/Shine-On_Horiz_white_RGB_Saskatoon-scaled.png" alt="YMCA Logo">
    </div>
  </div>
</div>

<script>
// === Dashboard Data ===
fetch('dashboard-data.json')
  .then(res => res.json())
  .then(data => {
    // --- Media ---
    const mediaContainer = document.getElementById('media-container');
    data.media.forEach(item => {
      if(item.type === 'image'){
        const img = document.createElement('img');
        img.src = item.src;
        mediaContainer.appendChild(img);
      } else if(item.type === 'video'){
        const iframe = document.createElement('iframe');
        iframe.src = item.src + "?autoplay=1&mute=1&loop=1&playlist=" + item.src.split('/').pop();
        iframe.frameBorder = "0";
        iframe.allow = "autoplay; fullscreen";
        iframe.allowFullscreen = true;
        mediaContainer.appendChild(iframe);
      }
    });

    // --- Schedule ---
    const now = new Date();
    document.getElementById('schedule-header').textContent =
      now.toLocaleDateString(undefined, { weekday:'long', month:'long', day:'numeric' });

    const scheduleList = document.getElementById('schedule');
    scheduleList.innerHTML = '';
    data.schedule.forEach(item=>{
      const li = document.createElement('li');
      li.innerText = item.time + ' - ' + item.event;
      scheduleList.appendChild(li);
    });

    // --- Now playing ---
    function getCurrentClass(schedule){
      const now = new Date();
      const currentMinutes = now.getHours()*60 + now.getMinutes();
      let currentClass = "No class right now";
      schedule.forEach(item => {
        const [time, ampm] = item.time.split(" ");
        let [hours, minutes] = time.split(":").map(Number);
        if(ampm==="PM" && hours!==12) hours+=12;
        if(ampm==="AM" && hours===12) hours=0;
        const classStart = hours*60 + minutes;
        if(currentMinutes >= classStart && currentMinutes < classStart+60){
          currentClass = item.event;
        }
      });
      return currentClass;
    }
    function updateNowPlaying(){
      const currentClass = getCurrentClass(data.schedule);
      document.getElementById('now-playing-class').textContent = currentClass;
      document.getElementById('now-playing').style.background =
        currentClass==="No class right now" ? "rgba(255,255,255,0.2)" : "rgba(0,255,0,0.3)";
    }
    updateNowPlaying();
    setInterval(updateNowPlaying,900000);

    // --- Quotes ---
    const quotes = data.quotes || [];
    const slider = document.getElementById('quote-slider');
    let current = 0;
    function showQuote(){
      slider.textContent = quotes[current];
      current = (current+1)%quotes.length;
    }
    showQuote();
    setInterval(showQuote,5000);

    // --- Weather ---
    fetch('https://api.open-meteo.com/v1/forecast?latitude=52.1332&longitude=-106.6700&current_weather=true')
      .then(res=>res.json())
      .then(weather=>{
        const tempC = weather.current_weather.temperature;
        const wind = weather.current_weather.windspeed;
        const code = weather.current_weather.weathercode;
        const conditionMap = {
          0:{text:'Clear sky', emoji:'â˜€ï¸'},
          1:{text:'Mainly clear', emoji:'ðŸŒ¤ï¸'},
          2:{text:'Partly cloudy', emoji:'â›…'},
          3:{text:'Overcast', emoji:'â˜ï¸'},
          45:{text:'Fog', emoji:'ðŸŒ«ï¸'},
          48:{text:'Fog', emoji:'ðŸŒ«ï¸'},
          51:{text:'Drizzle', emoji:'ðŸŒ¦ï¸'},
          61:{text:'Rain', emoji:'ðŸŒ§ï¸'},
          71:{text:'Snow', emoji:'â„ï¸'},
          80:{text:'Showers', emoji:'ðŸŒ¦ï¸'},
          95:{text:'Thunderstorm', emoji:'â›ˆï¸'}
        };
        const condition = conditionMap[code] || {text:'N/A', emoji:'â”'};
        document.getElementById('temperature').innerText = `${tempC}Â°C`;
        document.getElementById('wind').innerText = `${wind} km/h`;
        document.getElementById('condition').innerText = condition.text;
        document.getElementById('weather-emoji').innerText = condition.emoji;
      });
  })
  .catch(err => console.error('Dashboard fetch error:', err));
</script>
</body>
</html>


