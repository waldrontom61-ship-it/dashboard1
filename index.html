<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YMCA Dashboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
    background: #000;
  }

  /* Container with 70/30 split */
  .container {
    display: flex;
    height: 100vh;
    width: 100vw;
  }

  /* Main video area */
  .main {
    width: 70%;
    height: 100vh;
    position: relative; /* for absolute iframe */
    overflow: hidden;
    background: #000;
  }

  .main iframe {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100vw;   /* cover video area */
    height: 100vh;
    transform: translate(-50%, -50%);
    border: none;
    object-fit: cover;
  }

  /* Sidebar */
  .sidebar {
    width: 30%;
    height: 100vh;
    background-color: rgba(224,0,52,0.95);
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    font-family: 'Montserrat', sans-serif;
  }

  #sidebar-header {
    text-align: center;
    font-size: 24px;
    font-weight: 900;
    margin-bottom: 20px;
  }

  /* Weather + Now Playing */
  .weather-nowplaying {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    font-size: 14px;
  }

  .weather p {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  #weather-emoji {
    font-size: 1.4em;
  }

  .now-playing {
    background: rgba(255, 255, 255, 0.2);
    padding: 5px 10px;
    border-radius: 6px;
    font-weight: bold;
    white-space: nowrap;
  }

  /* Schedule */
  .schedule {
    flex-grow: 1;
  }

  #schedule-header {
    text-align: center;
    font-size: 18px;
    font-weight: 900;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(255,255,255,0.4);
  }

  .schedule ul {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
  }

  .schedule li {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    text-align: center;
  }

  /* Quote slider */
  #quote-slider {
    text-align: center;
    font-size: 32px;
    font-style: italic;
    margin-bottom: 20px;
    min-height: 50px;
    line-height: 1.5;
  }

  /* Logo */
  #logo-container {
    text-align: center;
    margin-top: auto;
    margin-bottom: 20px;
  }

  #logo {
    width: 80%;
    max-width: 150px;
  }
</style>
</head>
<body>

<div class="container">
  <div class="main">
    <iframe id="video" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>

  <div class="sidebar">
    <h2 id="sidebar-header">YMCA of Saskatoon Schedule</h2>

    <!-- Weather + Now Playing -->
    <div class="weather-nowplaying">
      <div class="weather">
        <p>
          <span id="weather-emoji">⛅</span>
          <span id="temperature">--</span> |
          <span id="condition">--</span> |
          <span id="wind">--</span>
        </p>
      </div>
      <div class="now-playing" id="now-playing">
        Now: <span id="now-playing-class">Checking...</span>
      </div>
    </div>

    <!-- Schedule -->
    <div class="schedule">
      <div id="schedule-header"></div>
      <ul id="schedule"></ul>
    </div>

    <!-- Quote slider -->
    <div id="quote-slider"></div>

    <!-- Logo -->
    <div id="logo-container">
      <img id="logo" src="https://ymcasaskatoon.org/wp-content/uploads/2022/06/Shine-On_Horiz_white_RGB_Saskatoon-scaled.png" alt="YMCA Logo">
    </div>
  </div>
</div>

<script>
function getCurrentClass(schedule) {
  const now = new Date();
  const currentMinutes = now.getHours()*60 + now.getMinutes();
  let currentClass = "No class right now";

  schedule.forEach(item => {
    const [time, ampm] = item.time.split(" ");
    let [hours, minutes] = time.split(":").map(Number);
    if(ampm==="PM" && hours!==12) hours+=12;
    if(ampm==="AM" && hours===12) hours=0;

    const classStart = hours*60 + minutes;
    if(currentMinutes >= classStart && currentMinutes < classStart+60){
      currentClass = item.event;
    }
  });

  return currentClass;
}

fetch('dashboard-data.json')
.then(res=>res.json())
.then(data=>{
  document.getElementById('video').src = data.videoUrl;

  const now = new Date();
  document.getElementById('schedule-header').textContent =
    now.toLocaleDateString(undefined, { weekday:'long', month:'long', day:'numeric' });

  const scheduleList = document.getElementById('schedule');
  scheduleList.innerHTML='';
  data.schedule.forEach(item=>{
    const li = document.createElement('li');
    li.innerText = item.time + ' - ' + item.event;
    scheduleList.appendChild(li);
  });

  function updateNowPlaying(){
    const currentClass = getCurrentClass(data.schedule);
    document.getElementById('now-playing-class').textContent = currentClass;
    document.getElementById('now-playing').style.background =
      currentClass==="No class right now" ? "rgba(255,255,255,0.2)" : "rgba(0,255,0,0.3)";
  }
  updateNowPlaying();
  setInterval(updateNowPlaying,1800000);

  const quotes = data.quotes || [];
  const slider = document.getElementById('quote-slider');
  let current = 0;
  function showQuote(){
    slider.textContent = quotes[current];
    current = (current+1)%quotes.length;
  }
  showQuote();
  setInterval(showQuote,5000);

  fetch('https://api.open-meteo.com/v1/forecast?latitude=52.1332&longitude=-106.6700&current_weather=true')
  .then(res=>res.json())
  .then(weather=>{
    const tempC = weather.current_weather.temperature;
    const wind = weather.current_weather.windspeed;
    const code = weather.current_weather.weathercode;

    const conditionMap = {
      0:{text:'Clear sky', emoji:'☀️'},
      1:{text:'Mainly clear', emoji:'🌤️'},
      2:{text:'Partly cloudy', emoji:'⛅'},
      3:{text:'Overcast', emoji:'☁️'},
      45:{text:'Fog', emoji:'🌫️'},
      48:{text:'Fog', emoji:'🌫️'},
      51:{text:'Drizzle', emoji:'🌦️'},
      61:{text:'Rain', emoji:'🌧️'},
      71:{text:'Snow', emoji:'❄️'},
      80:{text:'Showers', emoji:'🌦️'},
      95:{text:'Thunderstorm', emoji:'⛈️'}
    };

    const condition = conditionMap[code] || {text:'N/A', emoji:'❔'};

    document.getElementById('temperature').innerText = `${tempC}°C`;
    document.getElementById('wind').innerText = `${wind} km/h`;
    document.getElementById('condition').innerText = condition.text;
    document.getElementById('weather-emoji').innerText = condition.emoji;
  })
  .catch(err=>console.error('Weather fetch error:',err));
})
.catch(err=>console.error('Dashboard fetch error:',err));
</script>

</body>
</html>
